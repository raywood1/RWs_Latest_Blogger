---
layout: post
title: "Ubuntu 10.04 and Windows XP Dual-Boot:  GRUB2 Woes"
date: 2010-10-02
---

<div class="post-body">
<p><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">I was installing Windows XP SP3 and Ubuntu.  I encountered some error messages early in the process.  This post describes the steps I took in an attempt to resolve those problems.</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><br/>
</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">First, I got this error:</div><blockquote><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">Setup did not find any hard disk drives installed in your computer.</div></blockquote><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">In <a href="//web.archive.org/web/20190906053715/https://www.google.com/search?q=detected+%22not+detected%22+drive+bios&amp;ie=utf-8&amp;oe=utf-8&amp;aq=t&amp;rls=org.mozilla:en-US:official&amp;client=firefox-a">my search</a> for a solution, I found <a href="https://web.archive.org/web/20190906053715/http://en.kioskea.net/forum/affich-52951-sata-drive-not-detected-while-installing-xp">a thread</a> offering a number of suggestions.  The one that worked for me was to go into the BIOS (hit Del at startup) and make sure the SATA controller was set to ATA, not AHCI.  Mine had started out as ATA, but a notice had popped up when I was first booting it, offering to change it to the AHCI, and I had accepted.  After I fixed this, the next bootup problem was this message:</div><blockquote><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">Windows could not start because the following file is missing or corrupt:</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><windows root="">\system32\hal.dll<br/>
Please re-install a copy of the above file.</windows></div></blockquote><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><a href="//web.archive.org/web/20190906053715/https://www.google.com/search?q=%22missing+or+corrupt%22+%22hal.dll%22&amp;ie=utf-8&amp;oe=utf-8&amp;aq=t&amp;rls=org.mozilla:en-US:official&amp;client=firefox-a">My search</a> on that led to <a href="https://web.archive.org/web/20190906053715/http://pcsupport.about.com/od/findbyerrormessage/a/missinghaldll.htm">a page</a> offering a number of suggestions.  I started with just rebooting.  That didn't fix it.  suggesting that I go into the BIOS and switch the order in which the BIOS would try to boot my hard drives.  This led to a new message:</div><blockquote><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">error: no such device: [UUID number]</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">grub rescue&gt;</div></blockquote><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">This apparently happened because I had previously installed Ubuntu on that hard drive.  For this one, I took <a href="https://web.archive.org/web/20190906053715/http://saysprasad.wordpress.com/2008/07/15/how-to-remove-grub-and-restore-the-windows-bootloader/">the advice</a> to boot from the WinXP installation CD, choose R to repair an existing installation, choose the existing installation (no administrator password), and type this sequence of commands:</div><blockquote><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><span style="font-family: 'Courier New', Courier, monospace;">D:\WINDOWS&gt; C:</span></div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><span style="font-family: 'Courier New', Courier, monospace;">C:\&gt; CD \</span></div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><span style="font-family: 'Courier New', Courier, monospace;">C:\&gt; FIXBOOT C:</span></div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><span style="font-family: 'Courier New', Courier, monospace;">C:\&gt; FIXMBR</span></div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><span style="font-family: 'Courier New', Courier, monospace;">C:\&gt; BOOTCFG /rebuild</span></div></blockquote><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">The last one led to an offer to add D:\WINDOWS to the boot list.  I took that offer.  But then it asked "Enter Load Identifier" and "Enter OS Load Options."  I didn't know what to add, so I just hit Enter for each.  This led to a new error message:</div><blockquote><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">Error: Failed to add the selected boot entry to the boot list.</div></blockquote><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">I guessed that the system was seeing the Windows installation on drive D because I had reversed the boot order in the BIOS.  I did think I had cabled them correctly, with the Windows drive going to SATA0 (i.e., the first SATA connector) on the motherboard.  I looked into <a href="//web.archive.org/web/20190906053715/https://www.google.com/search?q=%22load+identifier%22&amp;ie=utf-8&amp;oe=utf-8&amp;aq=t&amp;rls=org.mozilla:en-US:official&amp;client=firefox-a">Load Identifier</a> and found <a href="https://web.archive.org/web/20190906053715/http://support.microsoft.com/kb/330184">a Microsoft page</a> with information on that and other parts of this situation.  It told me to type the name of my operating system:  Microsoft Windows XP Professional, though apparently anything would do.  For OS Load Options, it said, type /fastdetect.  Unfortunately, this was not satisfactory.  I got the "failed" error again.</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><br/>
</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><a href="//web.archive.org/web/20190906053715/https://www.google.com/search?q=%22Error:++Failed+to+add+the+selected+boot+entry+to+the+boot+list.%22&amp;ie=utf-8&amp;oe=utf-8&amp;aq=t&amp;rls=org.mozilla:en-US:official&amp;client=firefox-a">The responses</a> to this seemed to lean in the direction of <a href="//web.archive.org/web/20190906053715/https://www.google.com/search?num=50&amp;hl=en&amp;client=firefox-a&amp;hs=T9V&amp;rls=org.mozilla:en-US:official&amp;q=edit+%22boot.ini%22+xp+sp3&amp;aq=f&amp;aqi&amp;aql&amp;oq&amp;gs_rfai">editing the boot.ini</a> file.  <a href="https://web.archive.org/web/20190906053715/http://www.velocityreviews.com/forums/t223515-invalid-boot-ini-message.html">A thread</a> on that gave me the idea of just copying my boot.ini file from another computer.  <a href="https://web.archive.org/web/20190906053715/http://support.microsoft.com/kb/289022">A Microsoft page</a> gave information on editing it if I was already in WinXP, which I wasn't.  <a href="https://web.archive.org/web/20190906053715/http://mirror.href.com/thestarman/asm/mbr/bootini.htm">A webpage</a> devoted to boot.ini said it should be possible to just delete the boot.ini file in order to boot the system.  The webpage also gave some sample boot.ini files.  I typed "help" at the prompt and got a list of options.  There didn't seem to be an editor in the Repair Console.  I typed "dir" to verify that boot.ini was there, and then typed "type boot.ini" to see what was in it.  It didn't look very complicated.  What's more, it looked like my XP Pro entry was already there, which could explain why my BOOTCFG command didn't work.  I pressed the up arrow to retrieve my BOOTCFG command and hit Enter to run that again, just in case.  It failed again.</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><br/>
</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">I typed "exit" and shut down the computer and swapped cables so that maybe this drive would show up as C rather than D.  That merely resurrected the "no such device" GRUB error.  I decided to explore that one for a while.  <a href="//web.archive.org/web/20190906053715/https://www.google.com/search?num=50&amp;hl=en&amp;client=firefox-a&amp;rls=org.mozilla:en-US:official&amp;q=%22no+such+device%22+Ubuntu+10.04+OR+Lucid+GRUB+OR+GRUB2+-wubi&amp;btnG=Search&amp;aq=f&amp;aqi&amp;aql&amp;oq&amp;gs_rfai">A search</a> led to some commands that I could have entered, but then I saw a suggestion that maybe I could fix it by just installing Ubuntu, which I had planned to do anyway, and let it sort itself out.  So I went ahead with that, following <a href="https://web.archive.org/web/20190906053715/http://raywoodcockslatest.blogspot.com/2010/09/ubuntu-1004-installation-streamlined.html">the Ubuntu installation approach</a> I had worked out previously.  But at this point I only did the initial installation from the CD, and then rebooted to see what the Windows situation was now.  Sadly, I still had the "no such device" error.</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><br/>
</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">I guessed that the problem was that I was using two drives.  One of them had perfectly reasonable Windows and Ubuntu installations on it.  The other had leftovers from some previous Ubuntu installation.  I didn't know for sure, but on that hunch I unplugged the second drive and rebooted.  But no, that gave me the "no such device" error either way, no matter which disk I plugged in.  I plugged in both drives, rebooted with the live CD, and ran System &gt; Administration &gt; GParted to take a look.  Interestingly, it showed that a partition on the second drive was marked as a boot drive, when it should not have been.  I changed that.  It didn't make a difference.</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><br/>
</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">Ultimately, I plugged in a USB drive while booted with the Ubuntu live CD, copied over the data files, wiped both of the drives in the machine, and reinstalled WinXP and Ubuntu, in that order.  That solved the problem.</div></p>
<div style="clear: both;"></div>
</div>

---
### Comments
