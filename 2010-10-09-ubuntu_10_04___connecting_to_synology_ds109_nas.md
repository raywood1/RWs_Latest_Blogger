---
layout: post
title: "Ubuntu 10.04:  Connecting to Synology DS109 NAS"
date: 2010-10-09
---

<div class="post-body">
<p>I had <a href="https://web.archive.org/web/20190906053713/http://raywoodcockslatest.blogspot.com/2010/09/connecting-network-attached-storage-nas.html">tried once before</a> to connect a Synology DS109 network attached storage (NAS) device to a computer running Ubuntu 10.04 (Lucid Lynx).  It was a frustrating, confusing experience.  But when I rebooted that computer into Windows XP, it connected it right away, with a little help from Synology's extremely responsive tech support.  Now I was ready to try again in Ubuntu.<br/>
<br/>
The first part was easy.  I navigated to the folder where I had placed the downloaded, unzipped copy of <a href="https://web.archive.org/web/20190906053713/http://www.synology.com/support/download.php?lang=us&amp;m=DS109">Synology Assistant for Linux</a>.  That is, in Ubuntu's Applications &gt; Accessories &gt; Terminal, I typed "cd /media/LOCAL/[foldername]."  (If there are spaces in the foldername, you would have to put quotation marks around everything after "cd.")  This folder now contained a couple of "How to Install" (or Uninstall) items and a file named "install.sh," along with the .tar.gz file.  I typed "sudo sh install.sh" and that installed Synology Assistant.  I designated /usr/local as the install path.  It told me that I could run the Assistant program from /usr/local/SynologyAssistant/SynologyAssistant, or through the symbolic link at /usr/local/bin/SynologyAssistant.  I right-clicked on the word "Applications" on the menu and chose Edit Menus &gt; System Tools &gt; New Item.  I filled in the name as Synology Assistant and I browsed to the symbolic link and selected it.  Now I had a working menu link under System Tools.  I ran that and got the Management tab in Synology Assistant.  I double-clicked on DiskStation and that opened up a tab in my Internet browser.  In theory, I could access the Synology DS109 from here.  I closed the Assistant and logged in on the browser tab.  I went into the File Browser and, what do you know, it was all working fine.  Having already run the firmware updater on the DS109, as described in the previous post, I didn't need to do that again, as I confirmed in Synology's Control Panel &gt; DSM Update.  In short, it seemed that the easy approach, for this part, would have been for me to start with the Windows setup, where I was more familiar with everything, and set up the DS109 that way, and then come to this point in Ubuntu.<br/>
<br/>
Now there was the matter of being able to work with files and folders on the DS109 from within Nautilus or Terminal.  This was where I had gotten stuck last time.  In Nautilus, near the top left corner, I clicked on the Tree option that I normally used and changed it to Places.  It showed several items that seemed to be a legacy of my previous attempts to set up networking. <br/>
<br/>
At this point, I contacted Synology tech support again.  They had used <a href="https://web.archive.org/web/20190906053713/http://www.teamviewer.com/index.aspx">TeamViewer</a> last time to troubleshoot my problem, so I went to <a href="https://web.archive.org/web/20190906053713/http://portablelinuxapps.org/">PortableLinuxApps.org</a> and downloaded <a href="https://web.archive.org/web/20190906053713/http://portablelinuxapps.org/TeamViewer%205/download">TeamViewer 5</a>.  It downloaded to my home folder.  I wasn't able to figure out how to run it, so I <a href="https://web.archive.org/web/20190906053713/http://portablelinuxapps.org/forum/viewtopic.php?f=2&amp;t=19&amp;p=283#p283">posted a note</a> on it.  I tried to show my network devices by typing "sudo lshw -C network," but that just showed me my ethernet controller.  Meanwhile, though, Synology tech support pointed me toward an <a href="https://web.archive.org/web/20190906053713/http://forum.synology.com/wiki/index.php/Mapping_a_Network_Drive#How_to_map_a_drive_using_a_Linux.2FUnix_Environment">article on their wiki</a>, on how to map a network drive in Linux.  In essence, they had me type these lines:<blockquote>sudo mkdir /mount/SYNDATA<br/>
sudo gedit /etc/cifspwd</blockquote>(I tried using that second line because what they actually recommended, "echo username=[username] &gt; /etc/cifspwd," gave me a "Permission denied" error, even when I preceded it with "sudo."  So on the first line of that blank new cifspwd file that I was creating in gedit, I typed the Synology username I wanted to use, and on the second line I typed that username's password.  I hit Enter after the password but didn't type anything on the third line.  I saved and closed the cifspwd file.  This, however, was not the right approach.  After some trial and error, I guessed that maybe what I was supposed to put into the cifspwd file was not this:<br/>
<blockquote>[username]<br/>
[password]</blockquote>but rather this:<br/>
<blockquote>username=[username]<br/>
password=[password]</blockquote>I  had assumed that the program would know that what I was typing on the  first line was the username, but now it seemed that, no, I had to say  so.  So if my username was "ray," then the first line would read "username=ray."<br/>
<br/>
This got me partway there.  The other part was to type "sudo gedit /etc/fstab" and add these two lines to the fstab:<br/>
<br/>
<blockquote>#Entry for SYNDATA<br/>
//192.168.2.1/SYNDATA                /media/SYNDATA        cifs    user,uid=ray,gid=users,rw,suid,credentials=/etc/cifspwd,iocharset=utf8 0 0</blockquote>where 192.168.2.1 was the number I got from Synology's Main Menu  &gt; System Information &gt; General tab &gt; Network  section &gt; IP address and "ray" was the username on the computer (not on the Synology).  I found that, if you had more than one device like SYNDATA, you could still use the same IP address on a separate fstab line, and otherwise everything except for the name (e.g., SYNDATA) would be the same.  After finishing my edits to fstab, I saved and closed it and typed these lines:<br/>
<blockquote>sudo chmod 0600 /etc/cifspwd<br/>
sudo mount -a</blockquote>First time around, when I had the wrong fstab entry (i.e., referring to "synologybox" rather than 192.168.2.1), this gave me an error:<br/>
<blockquote>mount: wrong fs type, bad option, bad superblock on //synologybox/SYNDATA, missing codepage or helper program, or other error (for several filesystems (e.g., nfs, cifs) you might need a /sbin/mount.<type> helper program)<br/>
In some cases useful info is found in syslog - try dmesg | tail or so</type></blockquote>I had also gotten another error, "mount point /media/SYNDATA does not exist," but I had fixed that by typing "sudo mkdir /media/SYNDATA."  In the course of troubleshooting, again with great help from the Synology tech support lady, I also discovered the alternative of mounting the DS109 from the command line, with something like this:<br/>
<blockquote>sudo mount -t cifs //192.168.2.1/SYNDATA /media/SYNDATA -o username=[username],password=[password],iocharset=utf8</blockquote>A bit of playing with that led me to discover that the password I was using contained an exclamation mark (!), and while that was no problem when logging in from the Windows machine, it was a problem on the Ubuntu machine, at least if I was logging in from the command line.  After adjusting to resolve that problem, I was able to connect to the Synology, and now I was showing SYNDATA as a drive in Nautilus, just like other partitions.  I still wasn't sure what to do about those Windows Network and DISKSTATION entries that showed up in Nautilus &gt; Places &gt; Network, but I decided to let that be a problem for another day.  I typed "sudo gedit /etc/fstab" and corrected the line to read as shown above.<br/>
<br/>
Incidental notes:  another troubleshooting step taken at some point (not sure when) was to type "sudo mount -t cifs."  Another problem was the demand, "Enter  password to unlock your login keyring," but every password I tried  failed.  I wanted to bail out, but the thing kept giving me the same  dialogs.  I had to use Force Quit to get it to shut up.  Second time around, though, I tried Cancel instead, and that let me go right on through.  Weird.<br/>
<br/>
Also, at one point in the troubleshooting process, the computer became completely unable to contact the outside world.  Firefox wasn't reaching webpages, and some of my Synology-related commands were producing a "Network is unreachable" error.  That seemed to be <a href="//web.archive.org/web/20190906053713/https://www.google.com/search?num=50&amp;hl=en&amp;newwindow=1&amp;client=firefox-a&amp;hs=4Y9&amp;rls=org.mozilla:en-US:official&amp;q=%22network+is+unreachable%22+ubuntu&amp;aq=f&amp;aqi=g2g-m2&amp;aql&amp;oq&amp;gs_rfai">a pretty common problem</a>.  I fiddled with some random commands, and it seemed that one of them had adjusted the situation.  The command in question might have been "dhclient eth0" but more likely was "/sbin/route add -net 0.0.0.0 gw 1.1.1.1 eth0" (replacing 1.1.1.1 with 192.168.2.1 in my case -- see above).  But then that turned out to be a false dawn; I was soon back at the "network is unreachable" error.  A day later, however, without any intervention by me other than to reboot the system, the computer was able to go online.<br/>
<span class="Apple-style-span"></span><br/>
So at this point, writing up these notes a day or two after I was finally able to get to the Synology DS109 through the Ubuntu machine, the main things that I did seem to have been to add the username and password to the cifspwd file in the correct format and use the right syntax in the fstab entry, as shown above.</p>
<div style="clear: both;"></div>
</div>

---
### Comments
**raywood**:
After the procedure described above, I went into a Windows XP virtual machine (VM) running on VMware Workstation 7.1 and tried to get the Synology folders to appear in Windows Explorer.  The trick was to go into VM > Settings > Options tab > Shared Folders and add the Synology folders via File System > /media.

**Anonymous**:
I've just used this method to access a Synology DS107e from my linux box (OpenSUSE 10) and it worked a treat. Thanks for the useful article

**lumidis**:
Thanks, very useful, also thanks for mentioning failures. Helped a lot. Lumidis

