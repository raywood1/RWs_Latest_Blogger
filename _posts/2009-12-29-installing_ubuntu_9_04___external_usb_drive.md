---
layout: post
title: "Installing Ubuntu 9.04:  External USB Drive"
date: 2009-12-29
---

<div class="post-body">
<p><div>I was <a href="https://web.archive.org/web/20190906053733/http://raywoodcockslatest.blogspot.com/2009/08/installing-ubuntu-904-jaunty-jackalope_25.html">installing Ubuntu 9.04</a> (Jaunty Jackalope) in a <a href="https://web.archive.org/web/20190906053733/http://h10025.www1.hp.com/ewfrf/wc/product?lc=en&amp;dlc=en&amp;cc=us&amp;lang=en&amp;product=3979087&amp;">Compaq CQ60-420US</a> laptop computer from which I had removed the original Windows Vista installation.   Although people generally advised against removing Vista and its recovery partition, I had several reasons for doing so:  (1) I wanted to use Ubuntu (I would use WinXP in a virtual machine when I needed to run Windows-compatible software); (2) given the limited size of my laptop's hard drive, I could use the extra 10GB or so that was used by the factory-installed Vista recovery partition; and (3) Vista had <a href="https://web.archive.org/web/20190906053733/http://www.liutilities.com/articles/laptops-vista-recovery-partition/">a reputation</a> of being slow, which was especially undesirable on the relatively underpowered hardware of a cheap laptop.<br/>
<br/>
After I repartitioned and reformatted the hard drive, I found that I could not get the Ubuntu system to recognize the external USB hard drive. (That drive was not a USB flash drive; it was a regular internal SATA hard drive in a <a href="//web.archive.org/web/20190906053733/https://www.google.com/search?hl=en&amp;safe=off&amp;rlz=1B3GGGL_enUS318US318&amp;num=50&amp;newwindow=1&amp;q=sata+intitle:rosewill+%22RX-358-S+SLV%22+external+usb&amp;aq=f&amp;oq&amp;aqi">Rosewill RX-358-S SLV</a> external enclosure.)  First, I took a few steps, recommended in various posts, that did not seem to make much difference:<br/>
<ol><li>Following <a href="https://web.archive.org/web/20190906053733/http://ubuntuforums.org/archive/index.php/t-1128849.html">some users</a>, I typed (in Terminal) "sudo gedit /etc/modules" and then added "usb_storage" as a separate line at the end of that file, exit, and reboot.</li>
<li>When that didn't solve the problem (though, for all I know, it may have helped), I typed "sudo mkdir /mnt/OFFSITE," where OFFSITE was the name I wanted for my external drive. Then I typed "sudo mount -a." But the rest of <a href="https://web.archive.org/web/20190906053733/http://myubuntublog.wordpress.com/2009/05/25/auto-mount-usb-hard-drive-at-boot/">those instructions</a> failed because the external drive still wasn't mounted.</li>
<li>I tried <a href="https://web.archive.org/web/20190906053733/http://ubuntuforums.org/showthread.php?t=1102562&amp;page=2">the advice</a> to use System &gt; Administration &gt; NTFS Configuration Tool &gt; Enable write support for external disk. Possibly this step takes place automatically if you type "sudo apt-get install ntfs-config" instead of installing ntfs-config through Synaptic. But it did not solve the problem.</li>
</ol>I also tried the advice to <a href="https://web.archive.org/web/20190906053733/http://ubuntuforums.org/showthread.php?t=1102562&amp;page=2">install</a> ntfsprogs (now included in the Synaptic list, above) and then type "sudo ntfsfix /dev/sdXX" where XX designates the correct drive (e.g., c1). This gave me "Volume is corrupt. You should run chkdsk." Given the NTFS orientation of ntfsprogs, this appeared to refer to the chkdsk program in Windows.<br/>
<br/>
<br/>
I didn't plan to install any version of Windows on this computer. My desktop computer was dual-boot, but for purposes of simplicity and to preserve disk space on the laptop's relatively small hard drive, I wanted to make this a Linux-only machine. So to run chkdsk, I tried restarting the computer with a Windows installation CD. But this introduced a new problem. Each time I booted the computer and hit the space bar in response to the CD's message, "Press any key to boot from CD," it went through the process of loading various drivers and then, when it reached the point of saying, "Setup is starting Windows" (in the bar at the bottom of the screen), it gave me a blue screen of death (BSOD): "A problem has been detected and Windows has been shut down to prevent damage to your computer," etc. The bottom line of the message referred to "STOP: 0x0000007B." (Note that I was getting this error before reaching the point of deciding whether I wanted to enter Recovery Console.)<br/>
<br/>
Research on this problem led to <a href="https://web.archive.org/web/20190906053733/http://support.microsoft.com/kb/324103">a Microsoft troubleshooting page</a>. It identified a number of possible problems, but I was not sure any of them applied precisely to me, and I hated to spend a lot of time on a troubleshooting wild goose chase (TWGC). I did run self-tests of hard drive and memory in the laptop's BIOS setup; that is, I rebooted the machine, hit the Esc key to go into BIOS setup, and ran its diagnostics. Those tests found no problems with those pieces of the laptop's hardware.<br/>
<br/>
It occurred to me, at this point, that possibly I needed a BIOS upgrade. I went to <a href="https://web.archive.org/web/20190906053733/http://h10025.www1.hp.com/ewfrf/wc/softwareCategory?lc=en&amp;dlc=en&amp;cc=us&amp;product=3979087&amp;rule=22176&amp;lang=en&amp;">the support webpage</a> for this laptop and discovered, there, a flaw in my plan to make this a Linux-only laptop: Compaq was not distributing firmware upgrades for its laptops in Linux form. To upgrade the firmware, I needed to be able to run Windows.<br/>
<br/>
Before addressing that problem, I tried rebooting the laptop from the Windows CD without the external USB drive connected. This could potentially defeat the purpose of booting from the Windows CD (i.e., I wanted to use it to run chkdsk on the external drive), but now I was curious. This, however, did not make a difference. Evidently the external USB drive was not the reason for this STOP 0x0000007B message.<br/>
<br/>
In that case, the Windows CD appeared to be objecting that it did not find a working version of Windows already installed on the laptop's internal hard drive. But that seemed silly. Of course there would be no version of Windows installed on a hard drive, if the purpose of running the Windows XP CD was to install Windows on that drive. How did this error message expect me to "run chkdsk /f" if I could not even run Windows?<br/>
<br/>
Well, I could install WinXP after all, make it a dual boot machine, and deal with the inevitable <a href="https://web.archive.org/web/20190906053733/http://raywoodcockslatest.blogspot.com/2009/02/ubuntu-grub-error-22-error-15.html">GRUB issues</a>, as Windows and Ubuntu fought over which system would load first and then, just when I needed the machine most, refuse to load either. Or I could give up on the idea of running Windows diagnostics or firmware updates on this laptop. But I had previously experimented with booting <a href="https://web.archive.org/web/20190906053733/http://raywoodcockslatest.blogspot.com/2009/08/trying-to-use-freedos-usb-drive-to.html">Linux from a USB drive</a> (a/k/a "thumb drive" or "jump drive"). Since then, I had become aware of another Linux USB drive approach known as Penlinux, where you could either <a href="https://web.archive.org/web/20190906053733/http://www.penlinux.com/">buy one</a> of their pre-configured Ubuntu 6.10 USB drives (for <a href="https://web.archive.org/web/20190906053733/http://www.penlinux.com/shop.html">about $45</a>, which was less than the cost of a 2GB USB drive back in 2007, when they apparently came up with this); or you could <a href="https://web.archive.org/web/20190906053733/http://www.penlinux.com/articles/put-linux-on-a-flash-drive.html">make one</a> for yourself. I had heard of similar things in Windows; I wondered whether I could boot Windows XP from a USB flash drive and do these various maintenance tasks that way. The discussion of setting up a bootable WinXP USB flash drive appears in <a href="https://web.archive.org/web/20190906053733/http://raywoodcockslatest.blogspot.com/2009/08/booting-windows-xp-from-usb-flash-drive.html">a separate post</a>.<br/>
<br/>
When I did boot the system with the bootable WinXP USB flash drive in TXT mode, I went into Recovery Console.  There, I got a screen I had not received previously:  "Setup has recognized the following mass storage devices in your computer:  [none]."  At this point, I did not have the external USB hard drive connected, so apparently this was OK.  I pressed Enter and got the ordinary Recovery Console.  There, a "dir" command produced "drive is not valid" messages for all drives other than C and D.  For C, I got "There is no floppy disk or CD in the drive."  D was recognized as the USB flash drive.  So Recovery Console, started by the USB flash drive, appeared unable to recognize even the mere existence of the Ubuntu-formatted internal hard drive.  I typed "exit" and rebooted the system without the USB flash drive inserted.  Ubuntu still booted up OK.  When I pressed a key to try to boot from the WinXP CD, I still got the BSOD and the STOP 0x0000007B message, as above.  So merely starting the system with the USB flash drive, by itself, did not seem to have made any helpful change in the system.  I booted with the USB flash drive again.  This time, after booting in TXT mode, I chose the Setup option instead of the Recovery Console option in the Windows XP Professional Setup process.  Unfortunately, this directed me to that same message:  "Setup has recognized the following mass storage devices . . . ."  But this time, when I pressed Enter to continue, I got the partitioner:  WinXP was willing to set itself up in the jump drive.  Again, though, it didn't see any other drives.<br/>
<br/>
* * * * *<br/>
<br/>
I thought that I might need to create (and, optionally, delete) a WinXP partition in order to completely rid this hard drive of the traces of Vista.  (I assumed Vista was the culprit; I had not seen these problems previously in WinXP.)  I booted my Gparted CD and inserted a 15GB NTFS partition before any other, where drive C would normally be.  I had hoped to use my new bootable USB flash drive to install WinXP on it, but that drive was still not booting this laptop successfully, so I tried to install WinXP on that partition using a <a href="//web.archive.org/web/20190906053733/https://www.google.com/search?hl=en&amp;q=slipstreamed+%22service+pack+3%22+OR+sp3+xp&amp;sourceid=navclient-ff&amp;rlz=1B3GGGL_enUS318US318&amp;ie=UTF-8">slipstreamed WinXP SP3 CD</a> instead.  That again gave me the "A problem has been detected" BSOD (above).<br/>
<br/>
It began to appear that the process of deleting all partitions and starting over was more difficult than I had realized.  That Recovery partition was <a href="https://web.archive.org/web/20190906053733/http://www.mydigitallife.info/2008/02/29/delete-and-remove-to-unlock-eisa-hidden-recovery-or-diagnostic-partition-in-vista/">no ordinary partition</a>.  There seemed to be <a href="https://web.archive.org/web/20190906053733/http://forum.notebookreview.com/showthread.php?p=2367169#post2367169/">a process</a> by which it could be deleted from inside Vista itself; but once the Vista partition was gone, so was that option.  At this point, I discovered <a href="https://web.archive.org/web/20190906053733/http://www.hiren.info/pages/bootcd">Hiren's BootCD</a>, another apparently famous funky tool that supposedly contained an unbelievable list of disk utilities.  I <a href="https://web.archive.org/web/20190906053733/http://www.hirensbootcd.net/">downloaded</a> a copy (version 9.9) and burned it to CD.  I booted it, and it gave me four options:  Boot from Hard Drive, Start BootCD, Start Mini Windows XP (which might well have done the same thing as the BartPE boot CD, as I now realized), and Windows Memory Diagnostic.  I chose Start BootCD and used it to run PartitionMagic 8.05 Pro.  PM did not see anything on the drive other than unallocated space.  I tried running another program, but got a mouse error; apparently at least some of the programs on Hiren's BootCD were best run after a fresh reboot.  I rebooted and tried Mini Windows XP.  It was able to recognize a USB flash drive, so I used one to copy over the DiskPart.exe program I had <a href="https://web.archive.org/web/20190906053733/http://raywoodcockslatest.blogspot.com/2009/08/booting-windows-xp-from-usb-flash-drive.html">previously downloaded</a>.  An <a href="https://web.archive.org/web/20190906053733/http://www2.think-less-do-more.com/avafind/">AvaFind</a> search of my drives revealed, at this point, that WinXP already contained DiskPart.exe, although in an apparently earlier (or at least smaller) version (i.e., 160KB rather than 191KB).  With the larger one onboard, I moved the USB flash drive to the target computer and tried to run it from within Mini Windows XP.  Unfortunately, this gave me an error message:  "Error creating process [msiexec.exe /l diskpart.msi].  Reason:  The system cannot find the file specified."  I found msiexec.exe on the other (working) computer and copied it, and the older DiskPart.exe (i.e., same date as the msiexec.exe), to the flash drive.  I tried again with this on the target computer.  This did give me the DISKPART prompt and the options described in my <a href="https://web.archive.org/web/20190906053733/http://raywoodcockslatest.blogspot.com/2009/08/booting-windows-xp-from-usb-flash-drive.html">other post</a>.  I typed "list disk."  It showed that I had only Disk 0, which was right (if you don't count the jump drive).  I typed "select disk 0" and then "clean."  After a moment, it said, "DiskPart succeeded in cleaning the disk."  I typed "list volume" and it did not show any volumes on the hard drive.  So it seemed that it had indeed cleaned the drive.  To test it, I tried something that had failed previously (see, again, my other post):  I typed "exit" (to get out of DiskPart.exe), inserted the Windows XP installation CD, and tried to boot it.  I got "NTLDR is missing" because, silly me, I had not yet removed the USB drive.  I removed it and tried again.  The disk churned for a long time and then gave me the familiar old BSOD.  The older version of DiskPart.exe had failed to fix the hard drive.  I restarted Hiren's BootCD and went into Hard Disk Tools &gt; HDD Regenerator &gt; Scan and repair.  It ran for about an hour and detected no errors.  (At this point, and repeatedly after this, I tried a number of other tools on Hiren's BootCD, not listed here.)  Seagate SeaTools for DOS told me that it was a Seagate hard drive.  I used that program's Advanced Features &gt; Erase Track ZERO.  I went into the Fujitsu low-level format tool, also on Hiren's BootCD, but it did not seem to recognize any drives.  I tried rebooting the Windows XP installation CD again, but it still gave me a BSOD.  In Hiren's BootCD, I went back into Mini Windows XP &gt; BootCD WinTools, but didn't see anything that looked useful.  I tried Start &gt; Programs &gt; Check Disk, but it did not find a volume to work on.  Taking a different approach, I restarted the computer and chose Hiren's BootCD option (rather than Mini Windows XP) &gt; Partition Tools &gt; PartitionMagic Pro.  There, I selected the unallocated space (i.e., the only thing listed) and created an unformatted primary partition that used up all of the unallocated space.  I rebooted the WinXP installation CD, but still got a BSOD.  Back in Hiren's BootCD, I tried the Active Partition Recovery program.  It said this:<br/>
<blockquote>Logical C:<br/>
<br/>
Detected file systems:<br/>
<blockquote>from partition table: FAT32 (LBA)<br/>
from BOOT sector:  Unknown<br/>
</blockquote>Get file system from BOOT sector?  [Y/N]<br/>
</blockquote>I said Yes.  Next, it gave me an option to Perform Extended Disk Scan, with this note:<br/>
<blockquote>Extended Disk Scan may detect partitions being deleted even if you have created new ones instead, formatted and used them!<br/>
</blockquote>The screen also showed two partitions within HDD 80h.  I arrowed down so that the first of them was highlighted:  "Logical C."  This gave me an error message:  "Error reading sector # 0 or BOOT sector is invalid."  When I highlighted the second one, "Unallocated," I got no error message, but it was weird that this partition was only 2.49MB.  Anyway, I went back and ran the Extended Disk Scan.  It was slow.  After a while, it detected a 14.9GB NTFS logical drive.  The program gave me the option of adding this partition to the drives list.  I said yes.  There was another one, a while later, a 35GB partition.  Yes to that too.  Both of these, I thought, were WinXP partitions that I had created, during the past month or so of fooling around with this laptop.  As the scan reached the halfway mark, I was getting concerned that it hadn't yet found either the original Vista partition or the original Recovery partition.  But then, about three-fourths of the way through, it did find a 10.9GB partition.  The whole process took maybe six hours, on a 250GB drive.  When it was done, I had three logical drives and two unallocated portions.  Now what?  I thought maybe I would take a look at these partitions in one of the other programs there on the Hiren's BootCD, so I hit Esc.  This gave me an option of writing the detected partition information back to the hard drive.  As I reflected on the matter, I decided that these former partitions were sort of like a former girlfriend:  sure, things hadn't been so good with them, but then, things hadn't been so great without them either.  So I decided sure, why not, let's take them back.  Just like that, they were written to the hard drive, and I was rebooting.  I went back into the partition tools, there on Hiren's BootCD, and took another look via PartitionMagic.  Now PartitionMagic said it had "detected an error 116," and offered to fix it.  I said sure.  Now there was another error, partition table error #108.  PartitionMagic was willing to format the single partition that it did find, so I went with that.  It said it was "formatting partition *:  (BADMBR)," but then it gave me Error #4, "Bad argument/parameter."  Bad argument, indeed:  this really was turning out like a reunion with an ex-girlfriend!<br/>
<br/>
I decided to fight fire with fire.  Vista had created this problem; maybe Vista could undo it.  Probably the clearer reasoning would have been, they did this at a factory, so I need a factory to fix it.  But I wasn't reasoning along those lines.  I had gotten my hands on a copy of Microsoft Vista, and I was going to install it and see what would happen.  The Vista DVD gave me an option of recovering my system, but I didn't have any previous images it could work from, so I went ahead with the installation option.  Vista detected the five partitions or unallocated spaces that Active Partition Recovery had restored.  I told Vista to delete each of those partitions.  Now I had one big 232.9GB unallocated space.  I went ahead with the installation of Vista into that big empty space; maybe I should have used the option to format that unallocated space first.  But the main thing was that Vista installed, where WinXP had failed to do so.  That was promising.  Maybe it wouldn't even have been necessary to install Vista; maybe WinXP would have installed OK after I ran Active Partition Recovery.  But maybe not; after all, PartitionMagic was still confused.  Speaking of which, I decided to run it again, after Vista finished installing itself.  This time around, when PartitionMagic on Hiren's BootCD detected an error, I didn't let it fix it; I now dimly recalled that PartitionMagic never got entirely comfortable with larger hard drives.  Maybe if I hadn't let it fix the imaginary error the last time, it would have worked OK.  But probably not:  as before, it still thought we had a partition table error #105.  I took out Hiren's BootCD and put in the Windows XP installation CD, and rebooted.  But, wouldn't you know it, I still got a BSOD.  Vista was happy with the hard drive; Ubuntu was happy with the hard drive; but WinXP couldn't be satisfied.  Well, I had a Seagate Seatools CD from mid-2007.  I assumed it was newer than the Seatools for DOS found on Hiren's BootCD, but <a href="https://web.archive.org/web/20190906053733/http://www.seagate.com/www/en-us/support/downloads/seatools">perhaps not</a>.  What could this Seatools CD tell me?  I rebooted with that CD, and I discovered that it could tell me, "No Hard Drives Found."<br/>
<br/>
It seemed that Vista had its own special way with my hard drive.  This called for a choice.  I could leave Vista alone, giving it its own 15-20GB partition - that is, I could venture into the land of the <a href="//web.archive.org/web/20190906053733/https://www.google.com/search?hl=en&amp;q=vista+ubuntu+%22dual+boot%22&amp;sourceid=navclient-ff&amp;rlz=1B3GGGL_enUS318US318&amp;ie=UTF-8">Vista-Ubuntu dual boot</a>.  That might be the eventual outcome, but first I felt it was a good idea to screw around some more.  I thought I might start by using Gparted to reduce the size of the Vista partition, as if I really were going to set up a dual-boot system after all, and see what happened then.  So that's what I did.  I booted with my Gparted CD, removed the 1MB unallocated space prior to the Vista partition, shrank the Vista partition to 30GB, inserted a 30GB ext3 and 5GB swap partition after that, and left the rest for an ext3 partition for data.  Then I rebooted into Vista.  I got Windows Boot Manager, telling me this:<br/>
<blockquote>Windows failed to start.  A recent hardware or software change might be the cause.  To fix the problem:<br/>
<br/>
1.  Insert your Windows installation disc and restart your computer.<br/>
2.  Choose your language settings, and then click "Next."<br/>
3.  Click "Repair your computer."<br/>
</blockquote>I did this, using the Vista DVD.  I chose the "Repair and Restart" option, removed the DVD, and rebooted.  Vista ran a disk check and then came up OK, but wanted to reboot because of hardware changes.  After that second reboot, it seemed to be functioning normally.  I rebooted with Gparted, to see what had changed.  There was now a 6MB unallocated space after the Vista program partition.  So possibly what screwed things up was that I removed that 1MB unallocated space that had been before the Vista partition.  I ran a check on the two ext3 partitions in Gparted.  They were OK.  I rebooted with the WinXP CD and, as usual, I pressed a key to boot from the CD.  This time, I got this:<br/>
<blockquote>Windows Boot Manager<br/>
<br/>
Choose an operating system to start, or press TAB to select a tool:<br/>
(Use the arrow keys to highlight your choices, then press ENTER.)<br/>
</blockquote>Vista (recovered) was the only option.  I restarted the computer and tried again to boot from the WinXP CD.  Still got a BSOD.  I could have uninstalled Vista and reformatted the drive, just to see if there was somehow a "right" way to remove Vista, thereby making the drive once again accessible from the WinXP installation CD.  I decided instead to get my Ubuntu installation in place in <a href="https://web.archive.org/web/20190906053733/http://raywoodcockslatest.blogspot.com/2009/09/vmware-workstation-653-on-ubuntu-904.html">a Vista dual-boot</a>.  Maybe I wouldn't need to go back to WinXP or worry about it anymore, and could perhaps even replace the Vista partition with an occasional <a href="//web.archive.org/web/20190906053733/https://www.google.com/search?hl=en&amp;q=usb+flash+OR+jump+OR+thumb+bootable+vista&amp;sourceid=navclient-ff&amp;rlz=1B3GGGL_enUS318US318&amp;ie=UTF-8">Vista boot from a USB drive</a> (for purposes of e.g., upgrading the laptop's firmware).<br/>
<br/>
In that case, the final question was whether Vista and Ubuntu could work with the external USB hard drive.  That, you will recall, was the question that triggered this expedition.Â  By this point, however, I had begun to suspect that the problem was with the external hard drive, which <a href="https://web.archive.org/web/20190906053733/http://raywoodcockslatest.blogspot.com/2009/12/ubuntu-904-error-while-copying-folder.html">appeared to be defective</a>.<br/>
</div></p>
<div style="clear: both;"></div>
</div>

---
### Comments
