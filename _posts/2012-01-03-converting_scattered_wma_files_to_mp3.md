---
layout: post
title: "Converting Scattered WMA Files to MP3"
date: 2012-01-03
---

<div class="post-body">
<p>I had .WMA files scattered around my hard drive.  I wanted to convert them to .MP3.  I could search for *.WMA, using a file finder or search tool like <a href="https://web.archive.org/web/20151130170906/http://raywoodcockslatest.blogspot.com/2011/05/windows-7-file-finder-review-of.html" target="_blank">Everything</a>, thereby seeing that those files were in many different folders.  Having already sorted them, I didn't want to move them anywhere for the format conversion.  I wanted to convert them right where they were.  A command-line tool would do this.  The general form of the command would be like this:  PROGRAM SOURCE TARGET OPTIONS.  For PROGRAM, I would enter the name of the command-line conversion program that I was going to be using.  For SOURCE and TARGET, I would enter the full pathname (i.e., the name of the folder plus the name of the file, like "D:\Folder\File to Convert.wma," where the target would end in mp3 rather than wma).  OPTIONS would be specified by the conversion program.  For instance, there might be an option allowing me to indicate that I wanted the resulting MP3 file to be 64bps.<br/>
<br/>
The problem was, I didn't have a command-line WMA to MP3 conversion tool.  I ran <a href="https://web.archive.org/web/20151130170906/https://www.google.com/search?num=50&amp;hl=en&amp;newwindow=1&amp;client=firefox-a&amp;hs=7VE&amp;rls=org.mozilla%3Aen-US%3Aofficial&amp;q=%22command+line%22+convert+wma+mp3+OR+wav+windows+freeware&amp;oq=%22command+line%22+convert+wma+mp3+OR+wav+windows+freeware&amp;aq=f&amp;aqi=&amp;aql=&amp;gs_sm=e&amp;gs_upl=71859l72750l0l73249l9l8l0l4l0l2l392l1154l0.1.1.2l4l0" target="_blank">a search</a> and wound up trying the free <a href="https://web.archive.org/web/20151130170906/http://www.boxoft.com/wma-to-mp3/" target="_blank">Boxoft WMA to MP3 Converter</a>.  (They also had lots of other free and paid <a href="https://web.archive.org/web/20151130170906/http://www.boxoft.com/products.html" target="_blank">conversion and file manipulation programs</a>.)  When I ran their converter, it steered me to an instruction file that inspired me to compose the following command (all on one line):<br/>
<blockquote>AlltoMp3Cmd "D:\Folder\Filename.wma" "D:\Folder\Filename.mp3" -B56</blockquote>I had to use quotation marks around the source and target names in some cases (though not in this particular example) because some of the path or file names contained spaces.  The -B56 option was supposed to tell it to produce a 56-bit MP3.  (I also tried it with a space:  "-B 56".)  I was able to produce similar commands en masse, for all of the WMAs that I wanted to convert, by exporting the results of the *.WMA search from Everything to a text file called wmalist.txt, making sure to remove entries for files that I did not wnat to convert.  (At the root of each drive containing files of interest, I could also have used this command, assuming wmalist.txt did not already exist:  dir *.wma /b /s &gt;&gt; D:\wmalist.txt.)  I then massaged the contents of wmalist.txt <a href="https://web.archive.org/web/20151130170906/http://raywoodcockslatest.blogspot.com/2011/04/using-spreadsheet-to-rename-thousands.html" target="_blank">using Microsoft Excel</a>.  So now I had all of these AlltoMp3Cmd commands ready to run.  I copied them all into a Notepad file named Renamer.bat.  All I had to do was double-click on it in Windows Explorer and it would run.<br/>
<br/>
I decided to try Renamer.bat with just one WMA file.  So I created another file, X.bat, with just one line in it, like the line shown above.  To run X.bat from the command line, so that I could see what it was doing, I would need a command window that was ready to execute commands in the folder where X.bat was located.  Problem:  X.bat was not in the same folder as Boxoft's AlltoMp3Cmd.exe executable program, so X.bat would fail.  If I didn't want to get into changing the computer's PATH, I could either put X.bat in the Boxoft program folder or I could copy AlltoMp3Cmd.exe to the folder where X.bat was located.<br/>
<br/>
Either way, I needed to open a command window in one of those two folders, so as to run X.bat.  I could start from scratch (Start &gt; Run &gt; cmd) and use commands (e.g., "D:" would take me to drive D and "cd \Folder" would take me to the folder where Filename.wma was located), or I could <a href="https://web.archive.org/web/20151130170906/http://raywoodcockslatest.blogspot.com/2011/11/documenting-computer-work-with.html" target="_blank">use Ultimate Windows Tweaker</a> to install a right-click option to open a command window in any folder.  I had already done the latter, so this step was easy.<br/>
<br/>
Once I had sorted out all that, I was ready to try running X.bat.  But when I did, it crashed the AlltoMp3Cmd.exe program.  If I clicked on Cancel when I got the crash dialog, the command window said this:<br/>
<blockquote class="tr_bq">Exception Exception in module AlltoMp3Cmd.exe at 0005B4E1.<br/>
Installation file incorrect. Please re-install it!.</blockquote>But reinstalling the Boxoft program didn't help.  I sent them a note to let them know of this problem and decided to try other approaches.  One possibility was that their program was suitable for Windows XP but not Windows 7, which I was using.  It didn't seem to be a question of how the main program was installed, since the error message was referring specifically to the AlltoMp3Cmd.exe command-line executable (which presumably would be the same on any Windows system).<br/>
<br/>
I decided to try running it in a Windows XP virtual machine (VM).  I had already installed Microsoft's <a href="https://web.archive.org/web/20151130170906/https://www.google.com/search?num=50&amp;hl=en&amp;newwindow=1&amp;client=firefox-a&amp;hs=mcz&amp;rls=org.mozilla%3Aen-US%3Aofficial&amp;q=%22Windows+Virtual+PC%22+%22Windows+7%22+&amp;oq=%22Windows+Virtual+PC%22+%22Windows+7%22+&amp;aq=f&amp;aqi=g8g-j2&amp;aql=&amp;gs_sm=e&amp;gs_upl=8654l13310l0l13742l2l2l0l0l0l0l198l385l0.2l2l0" target="_blank">Windows Virtual PC</a>, which came with a WinXP VM, so I fired it up to try the same command line in the same folder.  To move quickly to the proper folder in the WinXP command window, I ran my trusty old <a href="https://web.archive.org/web/20151130170906/http://raywoodcockslatest.blogspot.com/2010/07/tweaking-windows-xp-virtual-machine.html" target="_blank">RegTweak2.reg</a> file, created in Notepad, to install a right-click option to open a command window in any folder in Windows Explorer.  But when I tried to use it, I got an error:<br/>
<blockquote>'\\tsclient\D\Folder Name\Subfolder Name'<br/>
CMD.EXE was started with the above path as the current directory.<br/>
UNC paths are not supported.  Defaulting to Windows directory.<br/>
'\\tsclient\D\Folder Name\Subfolder Name'<br/>
CMD does not support UNC paths as current directories.</blockquote>A bit more playing around persuaded me that what this message meant was that command-line work in the VM would have to be done on what the VM considered a "real" (actually a virtual) drive -- in other words, drive C.  So I put copies of X.bat and AlltoMp3Cmd.exe into the VM's drive C, in a new folder I called Workspace, and I tried running X.bat from the command line there.  But again I got an error:  "AlltoMp3Cmd.exe has encountered a problem and needs to close."  Maybe the program wasn't built to handle paths.  For whatever reason, it looked like the Boxoft AlltoMp3Cmd command-line utility was not going to work for me.<br/>
<br/>
<a href="https://web.archive.org/web/20151130170906/http://download.cnet.com/1770-20_4-0.html?query=%22command+line%22+convert+WMA&amp;searchtype=downloads&amp;sort=edRating4%20asc&amp;rpp=30&amp;filter=os=133|licenseName=Free|platform=Windows,Webware|&amp;filterName=os=Windows%207|licenseName=Free|platform=Windows,Webware|&amp;sa=node&amp;tag=pe-searchFacetsTile;navForm" target="_blank">A search in CNET</a> brought up some other possibilities.  One was IrfanView, reminding me that I had used that program to work partway through <a href="https://web.archive.org/web/20151130170906/http://raywoodcockslatest.blogspot.com/2011/05/windows-7-verify-that-data-files-are-in.html" target="_blank">a somewhat similar problem</a> months earlier.  Using IrfanView version 4.28 and various insights described more fully in that other writeup (and in <a href="https://web.archive.org/web/20151130170906/http://irfanview-forum.de/archive/index.php/t-7538.html" target="_blank">a recent thread</a>), I went back to my original list of files in wmalist.txt and prepared this command:<br/>
<blockquote class="tr_bq">i_view32.exe /filelist=D:\wmalist.txt /convert=$D$N.mp3</blockquote>This command was supposed to use the file names ($N) and directories (i.e., folders, $D) specified in wmalist.txt to produce MP3 files with those same names, in those same directories.  Before trying it out, I made a copy of wmalist.txt and changed the original so that it contained only two lines, referring to WMA files on two different drives.  I ran the command shown above in a CMD window.  I got an error:<br/>
<blockquote>'i_view32.exe' is not recognized as an internal or external command, operable program or batch file.</blockquote>In other words, Windows 7 did not know where to look to find IrfanView.  I could have taken the steps mentioned above, moving the .txt file to wherever i_view32.exe was located; but since I used IrfanView often, I wanted to add it to the PATH variable so that Windows would permanently recognize it.  The solution was to go to Start &gt; Run &gt; SystemPropertiesAdvanced.exe (also available through Control Panel &gt; System &gt; Advanced System Settings) and then click on Environment Variables &gt; System Variables &gt; highlight Path &gt; Edit.  To see clearly what I was doing, I cut the existing Variable Value out of the dialog and doctored it in Notepad.  The basic idea was to add, to the end of the existing value, a semicolon and then (without adding a space after the semicolon) paste the location of i_view32.exe (found easily enough via an Everything search &gt; right-click &gt; Copy path to clipboard).  I made sure to add a final backslash ("\") after the path to i_view32.exe.  I pasted that back into the dialog, OKed my way out of System Properties, went back into the command window, pressed the Up arrow key to repeat the command ... and it still didn't work.  I thought that possibly I would have to reboot to have the new PATH definition take effect.  That was the answer to that particular problem.  After rebooting, in a command window, I ran the command shown above, and there were no errors.  IrfanView was open, but nothing was in it.  I ran searches in Everything for the two files in my test WMAlist.txt file, with wildcard extensions (i.e., I searched for Filename.*).  No joy:  there were no MP3 versions of those files.  I tried a modified version of the command:<br/>
<blockquote>i_view32.exe /filelist=D:\wmalist.txt /convert=D:\*.mp3</blockquote>but that produced no output in D.  The IrfanView command was not working.  I tried yet another variation, as above but without "D:\" but that wasn't it either.  I tried the original command without using the filelist option:<br/>
<blockquote>i_view32.exe "D:\File Path\File Name.wma" /convert=$D$N.mp3</blockquote>This produced an error:<br/>
<blockquote>Error!  Can't load 'D:\File Path\File Name.wma'</blockquote>Did that mean that the /convert option was not being recognized?  Everything indicated that no MP3 file had been created.  And why would IrfanView be unable to load the existing WMA file?  It could load it easily enough from Windows Explorer or Everything.  I tried again:<br/>
<blockquote>i_view32.exe "D:\File Path\File Name.wma"</blockquote>That worked:  IrfanView played the file.  So the convert option was the problem.  Another variation:<br/>
<blockquote>i_view32.exe "D:\File Path\File Name.wma" /convert="File Name.mp3"</blockquote>If that did work, I wasn't sure where the output file would turn up.  No worries there:  it didn't work.  I got the "Can't Load" error again.  IrfanView's help file said that it did support wildcards for /convert, so that was presumably not the problem.  I had seen an indication that IrfanView would not batch-convert certain kinds of files, but WMA was not on the list I saw.  I was going to post a question in the relevant IrfanView forum, but at this point they weren't letting me in, for some reason.  Eventually it occurred to me to look in IrfanView's File &gt; Batch Conversion/Rename area, where it appeared that the program would support only image conversions, not audio.<br/>
<br/>
It seemed I would need to continue searching for a command-line option.  Back at that CNET search, I looked at the <a href="https://web.archive.org/web/20151130170906/http://download.cnet.com/Koyote-Free-Mp3-Wma-Converter/3000-2140_4-10442362.html" target="_blank">Koyota Free Mp3 WMA Converter</a> -- from another company that offered <a href="https://web.archive.org/web/20151130170906/http://www.koyotesoft.com/" target="_blank">multiple free conversion products</a> -- but saw no indications that it had command-line options.  Likewise for <a href="https://web.archive.org/web/20151130170906/http://download.cnet.com/Power-MP3-WMA-Converter/3000-2140_4-10113420.html" target="_blank">Power MP3 WMA Converter</a> and others.<br/>
<br/>
I finally opted for a kludge solution.  Using an Excel spreadsheet, I created a batch file (again, using techniques described in the other post referenced above and <a href="https://web.archive.org/web/20151130170906/http://raywoodcockslatest.blogspot.com/2011/04/finding-last-occurrence-of-character-in.html" target="_blank">elsewhere</a>) to rename each file in WMAlist.txt to a unique name (example:  ZZZ_00001.wma) -- after making sure I did not already have any files with that kind of name.  The unique names would help to insure that all WMA files would get the treatment, even if two of them had the same original name.  This produced 386 files.  Then, using Everything, I selected and moved all ZZZ_*.wma files to D:\Workspace.  Somehow, only 375 files made it to that folder.  It turned out that I had inadvertently included WMA program files from drive C after all, which I had not wanted to do, and for some reason a few of those were not moved to D:\Workspace -- probably for insufficient rights.  So now I would have to undo that damage.<br/>
<br/>
After taking care of that, in D:\Workspace, I tried the Boxoft program again, this time using its Batch Convert mode.  It took a while.  Spot checks suggested that the conversion quality was good.  I wasn't sure what bitrate to use to convert the files.  It seems that, at 56 kbps for what appeared to be a bunch of voice (not music) files, I erred on the high side.  I started with 353 WMA files occupying a total of 237MB, and I ended up with 353 MP3 files occupying 405MB.  Those files were converted at what appeared, at quick glance, to be a rate of about 6MB per minute.  I then revised the spreadsheet to produce batch file command lines that would move those MP3s back to the folders where the similarly named WMA files had been and rename them back to their original names (but with MP3 extensions).</p>
<div style="clear: both;"></div>
</div>

---
### Comments
**raywood**:
I laterrememberedthat, instead of editing the PATH statement, I could also get the system to recognize a simple shorthand expression for a program (e.g., IrfanView) by creating a shortcut to the program (e.g., i_view32.exe) and giving that shortcut the desired shorthand name (e.g., IrfanView).  I would then put the shortcut in C:\Windows.  Once that was done (possibly after rebooting), I could just use IrfanView on the command line without worrying about its full program name or path.  I kept a folder for such shortcuts and copied them to C:\Windows all at once whenever I had to reinstall Windows.

**raywood**:
Correction.  I just tried it.  It works with some programs (e.g., Firefox, Excel) but not with IrfanView.  It could bean issue with IrfanView; not sure.  But the general command syntax is like this:start Excel "" filename.xlswhere the empty quotation marks are sometimes necessary to make a program happy.

