---
layout: post
title: "Windows 7:  Setting and Maintaining Accurate System Time"
date: 2012-02-25
---

<div class="post-body">
<p>I wanted to keep two computers' clocks set the same, for purposes of synchronization, so that they would have an accurate sense of whether the version of File X on computer A was newer than the version of File X on computer B.  I had previously installed (or, more accurately, just added a copy of) Judah Levine's portable <a href="https://web.archive.org/web/20151210035459/https://encrypted.google.com/search?num=50&amp;hl=en&amp;newwindow=1&amp;client=firefox-a&amp;hs=WZp&amp;rls=org.mozilla%3Aen-US%3Aofficial&amp;q=%22nistime32%22+OR+%22nistime+32%22+%22Judah+Levine%22&amp;oq=%22nistime32%22+OR+%22nistime+32%22+%22Judah+Levine%22&amp;aq=f&amp;aqi=&amp;aql=&amp;gs_sm=3&amp;gs_upl=18716l20931l0l21114l15l13l0l0l0l0l212l1830l2.10.1l13l0" target="_blank">NISTIME 32</a> in something of a rush, when <a href="https://web.archive.org/web/20151210035459/http://raywoodcockslatest.blogspot.com/2011/12/windows-7-tweaked-installation-latest.html" target="_blank">installing Windows 7</a>, and, later, had vaguely recognized that it was not working right and/or I had not set it right.  Now I decided to work out the kinks in this function.<br/>
<br/>
<strong>NISTIME-32BIT.EXE</strong><br/>
<br/>
I started with the <a href="https://web.archive.org/web/20151210035459/http://www.nist.gov/index.html" target="_blank">National Institute of Standards and Technology</a> (NIST), from which programs like NISTIME 32 would draw the current time.  It developed that NIST had a program called <a href="https://web.archive.org/web/20151210035459/http://www.nist.gov/pml/div688/grp40/its.cfm" target="_blank">nistime-32bit.exe</a>.  It turned out to be the same as NISTIME 32, just slightly updated.  The webpage's instructions were to start by going into File &gt; Select Server and then Query Server &gt; Now.  Somewhere I saw advice to choose a server near me.  I was tempted to choose two different ones, one for each computer, so as to have accurate time in case there was some terrible disruption of the national timekeeping system.  Then I realized that this could have the effect of making rivers run upstream, where my files were concerned, to wit:  new could be replaced by old.  Being up-to-date on the latest developments in American chronology suddenly seemed less important than making sure I didn't accidentally overwrite today's crossword puzzle.<br/>
<br/>
When I went to the Query Server &gt; Now menu pick, I got a dialog indicating that NISTIME 32 was prepared to adjust my computer by 0.953 seconds.  I told it to go ahead.  I also went into Query Server &gt; Periodically and told it to update the computer every 12 hours.  Query Server &gt; Server Status confirmed these settings.  File &gt; Help in Choosing Dirs told me to hit File &gt; Save Config to save my settings.  This gave me "File Error:  Cannot open file to save configuration."  That problem may have been caused by nesting the program too deeply in a subfolder.  I moved it elsewhere and tried again. Now it seemed to confirm that it had saved my settings, and it created NISTIMEW.CFG in the same folder as the program's portable executable (nistime-32bit.exe).  I exited and restarted, and it remembered what I had told it.  But I had to remember to hit File &gt; Save Config; it would not remember anything.<br/>
<br/>
But then, when I did go into Query Server &gt; Periodically, specified 12 hours, and hit File &gt; Save Config and then File &gt; Exit, I could not get it back.  The program refused to become visible.  I tried a couple of times, and then looked at Windows Task Manager (Start &gt; Run &gt; taskmgr.exe) &gt; Processes tab.  Taskmgr showed four separate instances of "nistime-32bit.exe *32."  I selected them and clicked End Process, one by one, and then ran nistime-32bit.exe again.  It returned to taskmgr.exe, but not to the screen.  I minimized all windows, one by one, but, no, it was not lurking anywhere.  There didn't seem to be a taskbar or system tray icon for it.  It was here, and yet not here.  I killed the processes again, now that I had started one or two new ones.  I renamed NISTIMEW.CFG to be something else, and now it would start, and it saved new settings in a new NISTIMEW.CFG.  Apparently the config file had gotten corrupted.  I had originally created that file manually in lowercase (nistimew.cfg); possibly something about the program needed the uppercase filename.<br/>
<br/>
But now, same thing again.  Exiting and restarting gave me a hidden program:  visible in Task Manager's Processes tab, but not visible onscreen.  When I right-clicked on nistime-32bit.exe *32 in Task Manager and selected Properties, I got an error:  "Windows cannot find [pathname] nistime-32bit.exe."  I ended the process again.  I created a shortcut to the .exe and tried starting it that way.  I had no reason to think that would make any difference, and in fact it didn't.  I tried moving all of the files from the folder where I had put nistime-32bit.exe, and placed them all instead in C:\Windows, with a shortcut to the executable in my Start Menu.  That wasn't the answer; I still got lurking program sessions that appeared in Task Manager but nowhere else.  I deleted the CFG again and tried again.  Now it ran.  I went directly to File &gt; Save Config without making any changes.  It indicated that it had saved the config file.  I exited and restarted the program.  It ran.<br/>
<br/>
Now I saw something that may have explained the config file problem.  The server list had changed.  The Colorado server that I had selected previously was no longer listed in File &gt; Select Server.  I had previously gone into File &gt; Update Server List, and that had generated a message:  "New server file is C:\Windows\NIST-SRV.LST."  It did that again now, when I designated a new server.  I hit File &gt; Save Config and then File &gt; Exit, and then restarted the program.  Now it was running normally.  I moved the three files (the exe, cfg, and nist-srv.lst files) from C:\Windows back to the folder where I really preferred to have them.  It seemed that the server list had not properly updated when the files were in that folder originally.  I restarted and went through the same steps -- update server list, choose a new server, save config -- and now I was exiting and restarting without a problem.<br/>
<br/>
But no, I spoke too soon.  When I restarted, saved a 12-hour periodic refresh, and exited, it would not restart.  Deleting the config and moving the other files back to C:\Windows did not fix it.  The problem seemed to relate specifically to the attempt to set up recurrent time checks.  I was doing something wrong, or perhaps the program had a bug, or maybe it was not suited for 64-bit Win7.  I went to <a href="https://web.archive.org/web/20151210035459/http://www.nist.gov/pml/div688/" target="_blank">the NIST webpage</a> cited in the program's Help &gt; More Help and sent an email to the Webmaster link at the bottom of that page, pointing them here.<br/>
<br/>
<strong>The Built-In Windows Time Sync Option</strong><br/>
<br/>
I decided to look for an alternative time-updating program.  I ran <a href="https://web.archive.org/web/20151210035459/https://encrypted.google.com/search?q=update+system+time+%22Windows+7%22&amp;ie=utf-8&amp;oe=utf-8&amp;aq=t&amp;rls=org.mozilla:en-US:official&amp;client=firefox-a" target="_blank">a search</a> and discovered that there was apparently some kind of automatic time-updating arrangement built into Windows.  <a href="https://web.archive.org/web/20151210035459/http://technet.microsoft.com/en-us/library/cc773013%28v=ws.10%29.aspx" target="_blank">The advice</a> there was, however, that "The W32Time service is not a full-featured NTP solution that meets time-sensitive application needs."  That was consistent with the fact that my two computers' timeclocks tended to be somewhat inconsistent with one another.  I had not tried to see how inconsistent they could be, or how long they could remain that way.  I did see an indication somewhere that Windows defaulted to a weekly time update, so maybe it would verify that it was accurate to within a minute, or something, every week or so.<br/>
<br/>
That appeared to be steered by Control Panel &gt; Date and Time.  That dialog could also be opened by right-clicking the clock in the system tray and choosing Adjust Date/Time.  Or, as I now learned from <a href="https://web.archive.org/web/20151210035459/http://www.ericphelps.com/batch/rundll/" target="_blank">Eric Phelps</a>, it could also run from the command line via "rundll32.exe shell32.dll,Control_RunDLL timedate.cpl."  The latter option would facilitate the option of opening the Date and Time dialog for manual adjustment via, say, <a href="https://web.archive.org/web/20151210035459/http://raywoodcockslatest.blogspot.com/2011/07/windows-7-batch-files-that-run-things.html" target="_blank">a batch file</a> that would open it automatically (to the correct tab) every day, week, or whatever.  (Later, I found a <a href="https://web.archive.org/web/20151210035459/http://www.howtogeek.com/howto/windows-vista/sync-your-clock-with-internet-time-servers-from-the-vista-command-prompt/" target="_blank">How-To Geek webpage</a> that said I could just run "w32tm /resync" as administrator to resynchronize the clock without even going into the Date and Time dialog.  That, too, could be incorporated into a scheduled batch file.)<br/>
<br/>
The Date and Time dialog &gt; Internet Time tab &gt; Change Settings option gave me a choice of synchronizing with time.nist.gov, which I understood to be the most accurate (though others in that list, not counting time.windows.com, appeared to be cousins of NIST).  I noticed that the dialog told me, here, that "This computer is set to automatically synchronize on a scheduled basis."  The previous sync site, as I saw on the other computer, was time.windows.com."  I wasn't sure how synchronizing with that site could have left my two computers with different times -- differing by seconds, that is, not by minutes -- unless maybe time.windows.com was just not that worried about the seconds.  Or maybe it was trying to synchronize when my router was doing its daily self-restart, and was therefore not getting access to the online clock?  I wasn't sure.  (Note:  <a href="https://web.archive.org/web/20151210035459/http://answers.microsoft.com/en-us/windows/forum/windows_7-windows_programs/windows-7-time-sync-runs-update-weekly-how-do-i/3ad0278b-370d-416d-867a-534729ca7d32" target="_blank">Fouzan said</a> that this whole process wouldn't work if the computer was on a domain.)<br/>
<br/>
Curious about the timing, I went into Start &gt; Run &gt; taskschd.msc &gt; Task Scheduler Library.  There were maybe 15 items in the list, and none of them were obvious time sync tasks.  So another possibility was that some bug or tweak, brought into my system somewhere along the line, was preventing the creation or execution of the scheduling function.  Another emerging possibility was that, as stated in <a href="https://web.archive.org/web/20151210035459/http://www.howtogeek.com/howto/windows-vista/dealing-with-windows-vista-time-sync-problems/" target="_blank">a How-To Geek webpage</a>, time.windows.com (which my systems had been using by default) had "a ton of problems with uptime."  So possibly I had already fixed my problem, just by switching the machines to use time.nist.gov in the Date and Time dialog.  (I did notice, as soon as I made that switch and clicked the update button, that both computers' clocks showed exactly the same time.)<br/>
<br/>
<strong>Other Possibilities</strong><br/>
<br/>
I ran <a href="https://web.archive.org/web/20151210035459/https://encrypted.google.com/search?num=50&amp;hl=en&amp;newwindow=1&amp;client=firefox-a&amp;rls=org.mozilla%3Aen-US%3Aofficial&amp;q=%22Windows+7%22++freeware+sync+NIST+schedule&amp;oq=%22Windows+7%22++freeware+sync+NIST+schedule&amp;aq=f&amp;aqi=&amp;aql=&amp;gs_sm=3&amp;gs_upl=7354l12097l0l13357l3l3l0l0l0l0l130l382l0.3l3l0" target="_blank">another search</a> and found <a href="https://web.archive.org/web/20151210035459/https://www.techsupportalert.com/best-free-time-correction-utility.htm" target="_blank">a Gizmo recommendation</a> for Dimension 4 as a time correction utility.  It occurred to me, at this point, that possibly I had fixed my problem, just by switching away from time.windows.com (above), and that maybe I should just let things slide for a week or two.  I decided mostly just to record some notes, here, for possible future reference.  So instead of installing Dimension 4, I just dragged the icon for <a href="https://web.archive.org/web/20151210035459/http://www.thinkman.com/dimension4/" target="_blank">its webpage</a> from my browser's Address bar over to the Time subfolder in <a href="https://web.archive.org/web/20151210035459/http://raywoodcockslatest.blogspot.com/2011/01/windows-7-setting-up-customized-start.html" target="_blank">my customized Start Menu</a>.  If I ever needed it, I could follow the link at that time.<br/>
<br/>
There also appeared to be more to know than I had realized, regarding Task Scheduler (taskschd.msc).  In Task Scheduler's left-hand pane, I went down the tree into Task Scheduler Library &gt; Microsoft &gt; Windows &gt; Time Synchronization.  Now I saw that my machine was indeed set to synchronize time at 1 AM every Sunday.  I saw <a href="https://web.archive.org/web/20151210035459/http://www.makeuseof.com/tag/synchronise-computer-time-internet-custom-schedule-windows-7/" target="_blank">advice from Tina Sieber</a> on a way to adjust and improve the scheduling via Task Scheduler.  Tina seemed to believe, however, that using a separate program might be the simpler and more accurate approach.  Tina pointed toward two other programs, <a href="https://web.archive.org/web/20151210035459/http://www.worldtimeserver.com/atomic-clock/" target="_blank">Atomic Clock Sync</a> and <a href="https://web.archive.org/web/20151210035459/http://www.atomtime.com/" target="_blank">AtomTime</a>.  The webpage for the latter seemed very old.  I was not sure how it would fare in a 64-bit Windows 7 world.<br/>
<br/>
For now, the solution seemed to be simply to go into the system's clock and change its time source to NIST.  My monthly batch file brought up <a href="https://web.archive.org/web/20151210035459/http://www.time.gov/timezone.cgi?Eastern/d/-5" target="_blank">the NIST/USNO timepage</a> on the first of every month, so I could observe, later, whether my two computers were again diverging from one another and/or from the time on that webpage.  If they didn't stay in line, I would have two options.  One would be to add one of the foregoing command lines to my daily or weekly batch files, to permit manual and/or automatic checking and/or resynchronization.  Another would be to try one of the several freeware utilities just mentioned, particularly Dimension 4 or Atomic Clock Sync.</p>
<div style="clear: both;"></div>
</div>

---
### Comments
**raywood**:
The short answer here wsa to do a registry edit or run a batch file to change the time server.  I set mine to "2" instead of the "1" option shown onone webpage.

**raywood**:
I see I neglected to state the text of the batch file.  It is:Windows Registry Editor Version 5.00; Switch to using NIST as time server[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\DateTime\Servers]@="2""1"="time.windows.com""2"="time.nist.gov""3"="clock.isc.org""4"="timekeeper.isi.edu""5"="usno.pa-x.dec.com"I think other values could be substituted.  As shown here, I chose the NIST server.

**raywood**:
Another correction.  When I ran it this time, the attempt to update from option 2 gave me an error.  Option 5 (USNO) worked, though.

**raywood**:
One way to be notified that computer clocks are out of sync is to set them to runa batch fileat the same time each day.  For example, the batch might call up theMoo0 System Monitor-- quickly loaded, quickly removed.

**raywood**:
The arrangement cited above did not keep both computers exactly synchronized.  I decided to try Dimension 4.  If I provide no further comments, it will likely be because I had no further problems.

**Anonymous**:
You MUST run the file as Administrator to correct the time.Right click on Nistime and choose 'Run as Administrator'JC

